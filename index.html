<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Direktori Saluran WhatsApp</title>
</head>

  <body>
   <h1>Direktori Saluran WhatsApp Aktif Indonesia</h1>
  </body>
<stylele>{box-sizingnborder-boxofont-familylArialaHelveticacsans-serifi};body{margini0:backgroundnd:#f2f4f};header{backgroundnd:#25D36colorowhitetpaddingn20pxptext-aligngcentere};headereh1{margini0:font-sizez26pxp};headerep{margin-topo6pxpopacityt0.9.};}container{max-widtht900pxpmargini20pxpautotpaddingn15pxp};}search-box{margin-bottomo20pxp};}search-boxoinput{widtht100%0paddingn12pxpfont-sizez16pxpborder-radiusu8pxpbordere1pxpsolidid #cc};}channel-list{displayagridigrid-template-columnsnrepeat(auto-filllminmax(250pxp1fr)))gapa15pxp};}card{backgroundnwhitetborder-radiusu12pxppaddingn15pxpbox-shadowo0:4pxp10pxprgba(0(0,0,0.08)8text-aligngcenterepositionorelativev};}cardrh3{margini0:0 8pxp};}cardrp{font-sizez14pxpcoloror:#55};}cardra{displayainline-blockcmargin-topo10pxptext-decorationononenbackgroundnd:#25D36colorowhitetpaddingn8pxp12pxpborder-radiusu6pxpfont-sizez14px}x}delete-btn{n{ position:absolute;
  top:10px;
  right:10px;
  background:#ff4d4d;
  color:white;
  border:none;
  padding:5px 8px;
  font-size:12px;
  border-radius:6px;
  cursor:pointer;
}
.donate-popup{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);display:flex;justify-content:center;align-items:center;z-index:9999;}
.donate-box{background:#fff;padding:25px;border-radius:14px;max-width:400px;width:90%;text-align:center;position:relative;}
.donate-box span{position:absolute;top:10px;right:15px;font-size:22px;cursor:pointer;}
.donate-box a{display:inline-block;margin-top:15px;padding:10px 15px;background:#FF6B6B;color:white;border-radius:8px;text-decoration:none;font-weight:bold;}
footer{text-align:center;padding:15px;font-size:13px;color:#777;}
</style>
</head>

<body>

<!-- POPUP -->
<div id="donatePopup" class="donate-popup">
  <div class="donate-box">
    <span onclick="closeDonate()">‚úï</span>
    <h2>Selamat datang!</h2>
    <p>Kunjungi saluran WhatsApp utama:</p>
    <a href="https://whatsapp.com/channel/0029VbBS24J3gvWYXNUrRs45" target="_blank">Masuk Saluran</a>
    <p style="margin-top:15px;font-weight:bold;">DONASI</p>
    <a href="https://saweria.co/Animevora" target="_blank">Donasi Sekarang</a>
  </div>
</div>

<header>
  <h1>Direktori Saluran WhatsApp</h1>
  <p>Website publik untuk mencari & membagikan Saluran WhatsApp Indonesia</p>
</header>

<div class="container">

<section style="background:#fff;padding:15px;border-radius:12px;margin-bottom:20px;box-shadow:0 4px 10px rgba(0,0,0,0.08)">
  <h2>Submit Saluran WhatsApp</h2>
  <p>1 link WhatsApp hanya bisa disubmit 1 kali, oke, jangan serakah </p>

  <input type="text" id="name" placeholder="Nama Saluran WhatsApp" style="width:100%;padding:10px;margin-bottom:8px">
  <input type="text" id="desc" placeholder="Deskripsi singkat saluran" style="width:100%;padding:10px;margin-bottom:8px">
  <input type="text" id="link" placeholder="Link Saluran WhatsApp" style="width:100%;padding:10px;margin-bottom:8px">

  <button onclick="addChannel()" style="padding:10px 15px;background:#25D366;color:#fff;border:none;border-radius:6px">
    Submit Saluran
  </button>
</section>

<div class="search-box">
  <input type="text" id="searchInput" placeholder="Cari saluran WhatsApp">
</div>

<div class="channel-list" id="channelList"></div>
</div>

<footer>¬© 2025 Direktori Saluran WhatsApp</footer>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDHFMIP_uBX05tR7VIU06NsHeVcjgLoYoQ",
  authDomain: "direktoriwa-bf108.firebaseapp.com",
  databaseURL: "https://direktoriwa-bf108-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "direktoriwa-bf108",
  storageBucket: "direktoriwa-bf108.firebasestorage.app",
  messagingSenderId: "883369824396",
  appId: "1:883369824396:web:6c922a40e71fbc80ffaba9"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// OWNER (1 browser = 1 owner)
let ownerId = localStorage.getItem('ownerId');
if(!ownerId){
  ownerId = 'user_' + Math.random().toString(36).slice(2);
  localStorage.setItem('ownerId', ownerId);
}

const channelList = document.getElementById('channelList');
const searchInput = document.getElementById('searchInput');
const nameInput = document.getElementById('name');
const descInput = document.getElementById('desc');
const linkInput = document.getElementById('link');

// üîê SAFE KEY (1 LINK = 1 SUBMIT)
function safeKey(link){
  return link.trim().toLowerCase().replace(/\/+$/,'').replace(/[.#$/[\]]/g,'_');
}

// ‚ûï SUBMIT
function addChannel(){
  const name = nameInput.value.trim();
  const desc = descInput.value.trim();
  const link = linkInput.value.trim();

  if(!name || !desc || !link) return alert('Semua field wajib diisi');
  if(!link.includes('whatsapp.com/channel')) return alert('Link WhatsApp tidak valid');

  const key = safeKey(link);
  const refLink = db.ref('channels/' + key);

  refLink.once('value', snap=>{
    if(snap.exists()){
      alert('‚ùå Link ini sudah pernah disubmit');
      return;
    }

    refLink.set({
      name,
      desc,
      link,
      owner: ownerId,
      time: Date.now()
    });

    alert('‚úÖ Submit berhasil');
    nameInput.value='';
    descInput.value='';
    linkInput.value='';
  });
}

// üîÄ SHUFFLE
function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
  return arr;
}

// üì• LOAD DATA (ACAK)
db.ref('channels').on('value', snap=>{
  channelList.innerHTML='';
  let data=[];

  snap.forEach(child=>{
    data.push({key:child.key,...child.val()});
  });

  shuffle(data);

  data.forEach(c=>{
    const div=document.createElement('div');
    div.className='card';
    div.innerHTML=`
      ${c.owner===ownerId?`<button class="delete-btn" onclick="deleteChannel('${c.key}')">Hapus</button>`:''}
      <h3>${c.name}</h3>
      <p>${c.desc}</p>
      <a href="${c.link}" target="_blank">Masuk Saluran</a>
    `;
    channelList.appendChild(div);
  });
});

// üóëÔ∏è DELETE (OWNER ONLY)
function deleteChannel(key){
  if(confirm('Hapus saluran ini?')){
    db.ref('channels/'+key).remove();
  }
}

// üîç SEARCH
searchInput.addEventListener('keyup',()=>{
  const v=searchInput.value.toLowerCase();
  document.querySelectorAll('.card').forEach(c=>{
    c.style.display=c.innerText.toLowerCase().includes(v)?'block':'none';
  });
});

// ‚ùå POPUP
function closeDonate(){
  document.getElementById('donatePopup').style.display='none';
}
</script>

</body>
</html>
